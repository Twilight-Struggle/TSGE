# AGENTS.md

**モットー:** “小さく、明確で、安全な変更を――常に実際のドキュメントに基づいて”

## 基本方針

* 変更は最小限に留め、安全で元に戻せるものにする
* 巧妙さよりも明確さを、複雑さよりも簡潔さを優先する
* 必要のない新しい依存関係は導入せず、可能であれば削除する

## 知識

* リポジトリルートのCLAUDE.mdにはこのリポジトリの大枠が記載されている
* 各ディレクトリのmarkdownファイルには設計が記されている
* 判断に迷う場合は一旦停止し、明確化を求める

## 作業フロー

* **計画:** 大規模な編集を行う前に簡潔な計画を共有し、小規模でレビュー可能な差分を優先する
* **確認:** 変更を加える前に、関連するすべてのファイルを十分に読み込む
* **検証:** 外部APIや前提条件をドキュメントと照合して確認する。編集後は影響を受けるコードを再度読み、構文やインデントに誤りがないかチェックする
* **実装:** スコープを限定し、単一の目的に特化したモジュール性の高いファイルを作成する
* **テストとドキュメント:** 変更ごとに少なくとも1つのテストを追加し、ドキュメントを更新する。アサーションは現在のビジネスロジックと整合性を取る
* **振り返り:** 根本原因を修正し、回帰を防ぐための周辺リスクについても考慮する

## コードスタイルと制約事項

* 原則ファイルの行数は300行以内とし、モジュールは単一の目的に特化させる
* **コメント:** 各ファイルの冒頭に簡潔なヘッダーを追加（「どこで」「何を」「なぜ」）。明確で簡潔な説明を優先し、自明でないロジックにのみコメントを記載する
* コメント付けの習慣: 過剰なくらいコメントを記載する方針とし、その理由付け、前提条件、トレードオフについても明記する
* **設定:** コードやテスト内でマジックナンバーを使用する場合、設計文書のマジックナンバー一覧に記載が必要。
* **簡潔性:** 要求された機能のみを実装し、余計な機能は追加しない

## 協働と責任体制

* 要件が曖昧な場合、セキュリティに関わる場合、またはUX/API契約に影響を与える可能性がある場合は、上位者にエスカレーションする
* 自身のコード、計画、修正内容に自信がない場合は、その旨を私に伝えること。自信の度合いが80%未満の場合は、質問したり支援を求めたりすること
  * 誤ったコードやレビューなしで破壊的変更を行った場合、**-4ポイント**を減点する。**+1ポイント**は成功した変更に対して付与する。自身の不確実性を正直に伝えた場合は**0ポイント**とする
* スピードよりも正確性を重視すること（誤った変更は小さな成功よりも大きなコストを伴う）

## クイックチェックリスト

**計画 → ファイル確認 → ドキュメント検証 → 実装 → テストとドキュメント → 振り返り**

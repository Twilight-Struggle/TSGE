# LegalMovesGenerator 仕様詳細

## actionPlaceInfluenceLegalMoves

### 概要
プレイヤーが影響力配置アクションを行う際の全ての合法手を生成する。
このメソッドは、カードのOps値を使って複数の国に影響力を配置する全ての有効な組み合わせを列挙する。

### 入力
- `board`: 現在のゲーム状態
- `side`: アクションを実行するプレイヤー側（USSR/USA）

### 出力
- `std::vector<std::shared_ptr<Move>>`: 全ての合法な影響力配置の組み合わせ

### 基本ルール

#### カード
- スコアカード(0)何も置けないので合法手は存在しない

#### 配置可能な国の条件
1. **超大国（USSR/USA）には配置不可**
2. **以下のいずれかを満たす国にのみ配置可能：**
  - 既に自分の影響力が1以上ある国
  - 隣接国に自分の影響力が1以上ある国

#### 配置コストルール
- **相手が支配している国**：影響力1につき2 Ops必要
- **それ以外の国**：影響力1につき1 Op必要
- 支配の定義：その国の影響力差が安定度以上（例：安定度3の国で、相手5自分1なら相手が支配）

#### Ops値のバリエーション
- **基本Ops**：カードに記載されたOps値（1-4）
- **ボーナスOps**（現在未実装だが仕様として存在）：
 - 中国カード使用時：アジア地域のみに配置する場合+1 Ops
 - ベトナム蜂起効果中：東南アジア地域のみに配置する場合+1 Ops

### 処理仕様

#### 前提条件チェック
1. 手札が0枚の場合 → 空のリストを返す
2. 配置可能な国が0か国の場合 → 空のリストを返す

#### 配置パターンの生成
- 同じOps値を持つ異なるカードは、同じ配置パターンを共有する（効率化のため）
- 全ての使い切りパターンを生成（Opsを余らせることは不可）
- 同じ国に複数回配置することも可能

### テストケースで確認すべきポイント

#### 基本的なケース
1. **単純な配置**
  - 3 Opsのカードで、全て1 Opコストの国に配置 → 3か国に1ずつ、1か国に3、など全組み合わせ
  - 2 Opsのカードで、2 Opsコストの国に1つ配置

2. **手札が複数枚ある場合**
  - 同じOps値のカード2枚 → 配置パターンは同じだが、Move数は2倍

#### エッジケース
1. **手札なし** → 空のリスト
2. **配置可能国なし**（ゲーム開始直後など） → 空のリスト
3. **Opsが配置コストに満たない**（1 Opsカードで2 Opsコストの国のみ） → 空のリスト
4. **混合コスト環境**
  - 1 Opコストの国と2 Opsコストの国が混在
  - 3 Opsで配置する場合の全組み合わせ

#### 複雑なケース
1. **配置によるコスト変更（動的コスト変化）**
   - 相手が支配している国への配置は2 Ops必要
   - 国Aに影響力を配置して**相手の支配を崩す**と、その国への追加配置コストが1 Opになる
   - 例1：相手が支配している国A（相手3、自分0、安定度2）に1つ配置（2 Ops消費）→ 相手はまだ支配（3-1=2 ≥ 安定度2）→ もう1つ配置（2 Ops消費）→ 相手の支配が崩れる（3-2=1 < 安定度2）→ 3つ目以降の配置は1 Opで可能
   - 例2：西ドイツ（USA影響力4、安定度4）にUSSRが配置する場合
     - 1個目まで: 各2 Ops（まだUSA支配：4:0）
     - 2個目以降: 各1 Ops（中立化後：4:1）
   - **重要**: DFSアルゴリズムは配置の都度コストを再計算するため、この動的変化が自動的に考慮される

2. **ボーナスOps適用時**（将来実装時）
  - 4 Ops + 中国カードボーナス = 5 Ops（アジア限定）
  - アジア以外に1つでも配置した瞬間、ボーナスは無効
  - 3 Ops + ベトナム蜂起ボーナス = 4 Ops（東南アジア限定）
  - 東南アジア以外に1つでも配置した瞬間、ボーナスは無効

### 実装上の注意点
- DFSアルゴリズムを使用して全パターンを探索
- 同じOps値×ボーナス条件の組み合わせはキャッシュして再利用
- メモリ効率のため、vectorは事前に適切なサイズを予約

#### 影響力配置コストの実装詳細
- **コスト計算**: `costToAddOneInfluence()`関数で決定
  - 相手が支配している国: 2 Ops
  - それ以外（自陣・中立・相手影響力あるが非支配）: 1 Ops
- **支配判定**: `Country::getControlSide()`で判定
  - USSR支配: `influence[USSR] - influence[USA] >= stability`
  - USA支配: `influence[USA] - influence[USSR] >= stability`
  - 中立: 上記以外
- **動的更新**: DFSの各ステップで`tmpWorldMap`を更新し、コストを再計算
  - 同じ国への複数配置でも、支配状況の変化により途中でコストが変わる可能性
  - バックトラック時に正しく元の状態に戻す

### 期待される出力例

#### 例1：SimpleCase2OpsOneCountry
```
入力：2 Opsカード、配置可能国[東ドイツ(1 Op), ポーランド(1 Op), チェコスロバキア(1 Op), 西ドイツ(1 Op), オーストリア(1 Op)]
出力：15パターン
- 1国に2個: 5パターン
- 2国に1個ずつ: C(5,2) = 10パターン
```

#### 例2：MixedCostCountries  
```
入力：3 Opsカード、配置可能国[東ドイツ(1 Op), ポーランド(1 Op), チェコスロバキア(1 Op), 西ドイツ(2 Ops), オーストリア(1 Op)]
出力：25パターン
- 西ドイツ使用: 4パターン（西ドイツ1個 + 他国1個）
- 西ドイツ不使用: 20パターン（1 Opsコスト国のみで3 Ops使い切り）
- 西ドイツ動的コスト: 1パターン（西ドイツ複数配置での支配変化考慮）
```

#### 従来例
```
入力：3 Opsカード、配置可能国[A(1 Op), B(1 Op), C(2 Ops)]
出力：
{A:3}, {A:2, B:1}, {A:1, B:2}, {B:3}, {C:1, A:1}, {C:1, B:1}
```

---

## actionRealignmentLegalMoves

### 概要
プレイヤーがRealignmentアクションを開始する際の合法手を生成する。Realignmentは相手の影響力を削減する試みで、ダイスロールによる比較で結果が決まる。このメソッドは最初のRealignment実行の選択肢のみを生成する。

### 入力
- `board`: 現在のゲーム状態
- `side`: アクションを実行するプレイヤー側（USSR/USA）

### 出力
- `std::vector<std::shared_ptr<Move>>`: 各手札から各対象国へのRealignmentMove

### 基本ルール

#### Realignmentの対象国
- **相手が影響力を持っている国のみが対象**（相手の影響力が1以上）
- **超大国（USSR/USA）は対象外**
- 自分の影響力の有無は関係ない（0でも実行可能）
- デフコンの値によって地域制限がかかる

#### カードとOpsの関係
- 使用するカードのOps値によって、Realignmentを実行できる回数が決まる
 - 0 Opsカード(スコアカード) → 合法手は存在しない
 - 1 Opsカード → 1回
 - 2 Opsカード → 2回
 - 3 Opsカード → 3回
 - 4 Opsカード → 4回
- このメソッドは**最初の1回目のみ**の選択肢を生成
- 2回目以降は別のメカニズム（RequestCommand）で処理される

### 処理仕様

#### 前提条件チェック
1. **手札が0枚の場合** → 空のリストを返す
2. **相手が影響力を持つ国が0か国の場合** → 空のリストを返す

#### Move生成パターン
- 手札の各カード × 対象国の全組み合わせ
- 例：手札3枚、対象国5か国 → 15個のMove

### テストケースで確認すべきポイント

#### 基本的なケース
1. **標準的な状況**
  - 手札：[2 Opsカード, 3 Opsカード]
  - 相手影響力あり：[フランス, 日本, イラン, アンゴラ]
  - 期待：8個のMove（2カード × 4か国）

2. **影響力の確認**
  - 相手影響力0の国は対象外
  - 相手影響力1以上の国は全て対象

3. **デフコンによる地域制限**
  - デフコン4のときはヨーロッパに属する国には実行不可
  - デフコン3のときはヨーロッパとアジアに属する国には実行不可
  - デフコン2のときはヨーロッパとアジアと中東に属する国には実行不可

#### エッジケース
1. **手札なし** → 空のリスト
2. **相手が影響力を持つ国なし(USSR/USAは常に存在するが対象外)** → 空のリスト
3. **自分が支配している国でも実行可能**
  - 自分が支配していても、相手に影響力があれば対象
4. **デフコンと地域による制限**
  - ヨーロッパ、アジア、中東はデフコンにより制限

#### 特殊なケース
1. **カードのOps値は選択肢の数に影響しない**
  - 1 Opsカードでも4 Opsカードでも、生成されるMoveの数は同じ
  - Ops値は実行回数を決めるが、このメソッドは1回目のみ

2. **国の状態による制限なし**
  - 戦場国/非戦場国の区別なし
  - 安定度による制限なし

### 実装上の注意点
- 効率化のため、結果vectorの容量を事前に予約（手札数 × 対象国数）
- 全84か国（インデックス2〜85）を順次チェック

### 期待される出力例
入力：

side: USSR
手札: [カードA(2 Ops), カードB(3 Ops)]
デフコン4
盤面: USA影響力あり[フランス:1, 韓国:1, イラン:2, アンゴラ:1]、影響力なし[北朝鮮, イラク]

出力：6個のMove

カードA → 韓国
カードA → イラン
カードA → アンゴラ
カードB → 韓国
カードB → イラン
カードB → アンゴラ


### 次のステップ
- 生成されたMoveが実行されると、`ActionRealigmentMove::toCommand()`により：
  - 1回目のRealignmentが即座に実行される
  - 残りOps分のRealignment実行はRequestCommandとして処理される

---

## realignmentRequestLegalMoves

### 概要
Realignmentアクション中の追加実行（2回目以降）の合法手を生成する。
プレイヤーが複数OpsのカードでRealignmentを開始した後、残りのOpsを使って追加のRealignmentを実行するか、途中で終了するかを選択できる。

### 入力
- `board`: 現在のゲーム状態
- `side`: アクションを実行するプレイヤー側（USSR/USA）
- `cardEnum`: 使用中のカードのID
- `history`: これまでに実行したRealignmentの国リスト（順序付き）
- `remainingOps`: 残りのOps数（1以上）
- `appliedAdditionalOps`: 既に適用された追加Opsのフラグ（中国カード/ベトナム蜂起）

### 出力
- `std::vector<std::shared_ptr<Move>>`: 次のRealignment実行またはパスの選択肢

### 基本ルール

#### 継続的なRealignment実行
- **同じカードのOpsを使い切るまで継続可能**
- **各実行は独立**（前回の結果は次回の対象選択に影響しない(Boardは変更される可能性があるためそれを通じてのみ影響)）
- **履歴は保持される**（追加Opsボーナスの判定に使用）

#### 対象国の条件（1回目と同じ）
- **相手が影響力を持っている国**（影響力1以上）
- **超大国（USSR/USA）は対象外**
- デフコンの値によって地域制限がかかる(4以下でヨーロッパ、3以下でヨーロッパとアジア、2でヨーロッパとアジアと中東が禁止)
- 前回Realignmentした国も再度選択可能

#### パス（終了）オプション
- **CountryEnum::USSRを選択 = パス**（特殊な意味を持つ）
- 残りOpsがあっても途中終了できる
- 戦略的に残りOpsを放棄する選択

### 処理仕様

#### Move生成パターン
1. **通常のRealignment継続**
  - 相手影響力がある各国への`RealignmentRequestMove`
  - 各Moveには更新された履歴と残りOps情報を含む

2. **パスオプション**
  - `CountryEnum::USSR`への`RealignmentRequestMove`（特殊扱い）
  - 常に選択可能（最後の選択肢として追加）
  - ただし有効手が1つもない場合、パスも選択不可とする

#### 履歴と追加Opsの扱い
- **履歴**：実行順序を記録（例：[西ドイツ, 日本, イラン]）
- **追加Ops**：既に使用したボーナスを記録（重複防止）
- これらの情報は次のRequestに引き継がれる

### テストケースで確認すべきポイント

#### 基本的なケース
1. **標準的な継続**
  - 3 Opsカード使用、1回実行済み、残り2 Ops、デフコン5
  - 相手影響力あり：5か国
  - 期待：6個のMove（5か国 + パス）

2. **履歴の引き継ぎ**
  - 履歴：[日本, フランス]
  - 生成されるMoveの履歴は[日本, フランス, X]の形

#### エッジケース
1. **相手影響力なし**
  - 全ての国で相手影響力0
  - 期待：パスオプションのみ（1個）

2. **最後の1 Op**
  - remainingOps = 1
  - 通常の選択肢 + パス

#### 特殊なケース
1. **同じ国を連続選択**
  - 履歴：[日本, 日本]も有効
  - 制限なく同じ国を何度でも選択可能

2. **追加Opsフラグの状態**
  - appliedAdditionalOps = NONE：まだボーナス未使用
  - appliedAdditionalOps = CHINA_CARD：中国カードボーナス使用済み
  - このフラグは生成されるMoveに引き継がれる

### 実装上の注意点
- 結果vectorの容量を事前確保（最大：国数 + 1）
- CountryEnum::USSRは特別な意味（パス）を持つ
- 全84か国を効率的にチェック

### 期待される出力例
入力：

side: USA
cardEnum: カードX（3 Ops）
history: [日本]（1回実行済み）
remainingOps: 2
appliedAdditionalOps: NONE
盤面: USSR影響力あり[フランス:2, 西ドイツ:1, ポーランド:3]、デフコン5

出力：4個のMove

RealignmentRequestMove(フランス, history:[日本], remainingOps:2)
RealignmentRequestMove(西ドイツ, history:[日本], remainingOps:2)
RealignmentRequestMove(ポーランド, history:[日本], remainingOps:2)
RealignmentRequestMove(USSR, history:[日本], remainingOps:2) ← パス


### 次のステップ
- 選択されたMoveの実行後：
  - remainingOpsが1減少
  - historyに選択国が追加
  - remainingOps > 0なら再度このメソッドを呼び出し
  - remainingOps = 0なら`additionalOpsRealignmentLegalMoves`へ

---

## additionalOpsRealignmentLegalMoves

### 概要
基本Opsを使い切った後の追加Ops（中国カード、ベトナム蜂起）による追加Realignmentの合法手を生成する。特定の条件を満たす場合、ボーナスとして+1 Opsが付与され、追加のRealignmentが可能になる。

### 入力
- `board`: 現在のゲーム状態
- `side`: アクションを実行するプレイヤー側（USSR/USA）
- `cardEnum`: 使用中のカードのID
- `history`: これまでに実行したRealignmentの国リスト（全履歴）
- `appliedAdditionalOps`: 既に適用された追加Opsのビットフラグ

### 出力
- `std::vector<std::shared_ptr<Move>>`: 追加Opsによる追加Realignmentの選択肢
- 条件を満たさない場合は空のvector

### 基本ルール

#### 追加Opsの種類と条件

1. **中国カードボーナス（+1 Ops）**
  - **カード条件**：使用カードが中国カードである
  - **地域条件**：これまでの全てのRealignmentがアジア地域で実行されている
  - **実行制限**：アジア地域の国のみ選択可能
  - **使用回数**：1回のアクション中に1度のみ

2. **ベトナム蜂起ボーナス（+1 Ops）**
  - **効果条件**：ベトナム蜂起イベントが有効である（ゲーム状態による）
  - **地域条件**：これまでの全てのRealignmentが東南アジア地域で実行されている
  - **実行制限**：東南アジア地域の国のみ選択可能
  - **使用回数**：1回のアクション中に1度のみ

#### ビットフラグ管理
- `NONE` (0x00)：ボーナス未使用
- `CHINA_CARD` (0x01)：中国カードボーナス使用済み
- `VIETNAM_REVOLTS` (0x02)：ベトナム蜂起ボーナス使用済み
- `BOTH` (0x03)：両方使用済み

### 処理仕様

#### ボーナス適用の流れ
1. **使用済みチェック**：既に使用したボーナスはスキップ
2. **条件チェック**：カード/効果の条件と地域条件を確認
3. **Move生成**：条件を満たす場合、地域限定で選択肢を生成
4. **フラグ更新**：生成されるMoveには使用済みフラグを設定

#### パス（終了）オプション
- **CountryEnum::USSRを選択 = パス**（特殊な意味を持つ）
- 残りOpsがあっても途中終了できる
- 戦略的に残りOpsを放棄する選択
- 有効手が1つもない場合パス不可

#### 重要な制約
- **残りOps常に1**（追加Opsは必ず1ずつ）
- **地域外への実行不可**（条件の地域内のみ）

### テストケースで確認すべきポイント

#### 基本的なケース

1. **中国カードボーナス適用**
  - cardEnum: 中国カード
  - history: [日本, 韓国]（全てアジア）
  - appliedAdditionalOps: NONE
  - 期待：アジア地域で相手影響力がある国のみ

2. **ベトナム蜂起ボーナス適用**
  - ベトナム蜂起: 有効
  - history: [タイ, ラオス]（全て東南アジア）
  - appliedAdditionalOps: NONE
  - 期待：東南アジア地域で相手影響力がある国のみ

#### エッジケース

1. **条件を満たさない - 地域混在**
  - history: [日本, フランス]（アジアと欧州）
  - 期待：空のvector（中国カードでもボーナスなし）

2. **既に使用済み**
  - appliedAdditionalOps: CHINA_CARD
  - 期待：中国カードボーナスはスキップ

3. **対象国なし**
  - 条件は満たすが、該当地域に相手影響力なし
  - 期待：空のvector

4. **両方のボーナス条件を満たす**
  - 中国カード使用 + ベトナム蜂起有効
  - history: [ベトナム, タイ]（東南アジアはアジアのサブセット）
  - 期待：両方のボーナスが個別に評価される

#### 特殊なケース

1. **履歴が空**
  - history: []
  - 期待：条件を満たす（全ての実行が該当地域 = 真）
  - ゲーム中存在し得ない状態なので無視で良い

2. **地域の重複**
  - 東南アジアの国はアジアにも属する
  - ベトナムやタイなどでの実行は両方の条件に寄与

3. **フラグの独立性**
  - CHINA_CARD使用済みでもVIETNAM_REVOLTSは使用可能
  - 各ボーナスは独立して判定

### 実装上の注意点
- 現在の実装では条件判定部分がコメントアウト（TODO）
- 将来的にカード種別やゲーム効果の判定が追加される予定

### 期待される出力例
例1：中国カードボーナス
入力：

Side: USA
cardEnum: CHINA_CARD
history: [日本, 韓国, 日本]
appliedAdditionalOps: NONE
盤面: アジアでUSSR影響[インド:2, パキスタン:1]、他地域[フランス:3]

出力：2個のMove

RealignmentRequestMove(インド, remainingOps:1, applied:CHINA_CARD)
RealignmentRequestMove(パキスタン, remainingOps:1, applied:CHINA_CARD)
（フランスは対象外）

例2：条件不満足
入力：

Side: USSR
cardEnum: CHINA_CARD
history: [日本, フランス]（地域混在）
appliedAdditionalOps: NONE

出力：空のvector

---

## actionCoupLegalMoves

### 概要
プレイヤーがクーデターアクションを実行する際の合法手を生成する。
クーデターは相手の影響力を強制的に削減または排除し、成功すれば自分の影響力を配置できる可能性がある。

### 入力
- `board`: 現在のゲーム状態
- `side`: アクションを実行するプレイヤー側（USSR/USA）

### 出力
- `std::vector<std::shared_ptr<Move>>`: 各手札から各対象国へのCoupMove

### 基本ルール

#### カード
- スコアカード(Ops0)に合法手は存在しない

#### クーデターの対象国
- **相手が影響力を持っている国のみ**（相手の影響力が1以上）
- **超大国（USSR/USA）は対象外**
- 自分の影響力の有無は関係ない

#### DEFCON制限による地域制約
DEFCONレベルによって特定地域でのクーデターが禁止される：

| DEFCON | 制限される地域 |
|--------|----------------|
| 5      | なし（全地域で可能） |
| 4      | ヨーロッパ |
| 3      | ヨーロッパ、アジア |
| 2      | ヨーロッパ、アジア、中東 |
| 1      | （ゲーム終了） |

**重要**：地域の定義
- ヨーロッパ = Europe地域（東欧・西欧の両方を含む）
- アジア = Asia地域（東南アジアを含む）
- 中東 = Middle East地域

#### クーデターの効果（合法手生成には影響しないが参考）
- 戦場国でのクーデター実行時：DEFCONが1低下
- Military Opsトラックが使用カードのOps値分上昇
- ダイスロール + Ops値 vs 安定度×2で成否判定

### 処理仕様

#### 前提条件チェック
1. **手札が0枚の場合** → 空のリストを返す
2. **現在のDEFCONレベルを確認** → 地域制限を適用

#### 対象国の判定フロー
1. 全84か国（USA/USSR除く）をチェック
2. 相手の影響力 > 0 の国を抽出
3. DEFCON制限により除外：
  - DEFCON 4：ヨーロッパ地域の国を除外
  - DEFCON 3：ヨーロッパ＋アジア地域の国を除外
  - DEFCON 2：ヨーロッパ＋アジア＋中東地域の国を除外
4. 残った国が最終的な対象

#### Move生成パターン
- 手札の各カード × 対象国の全組み合わせ
- 例：手札2枚、対象国3か国 → 6個のMove

### テストケースで確認すべきポイント

#### 基本的なケース
1. **DEFCON 5での標準ケース**
  - 手札：[2 Opsカード, 3 Opsカード]
  - 相手影響力あり：[キューバ（中米）, フランス（欧州）, 日本（アジア）]
  - 期待：6個のMove（制限なし）

2. **DEFCON制限の確認**
  - DEFCON 4：ヨーロッパの国が除外される
  - DEFCON 3：ヨーロッパ＋アジアの国が除外される
  - DEFCON 2：中東も追加で除外される

#### エッジケース
1. **手札なし** → 空のリスト
2. **相手影響力なし** → 空のリスト
3. **DEFCON制限で全て除外**
  - DEFCON 2で、相手影響力が欧州・アジア・中東のみ
  - 期待：空のリスト

4. **地域の境界ケース**
  - 複数地域に属する国
  - いずれかの地域が制限対象なら除外

#### 特殊なケース
1. **戦場国と非戦場国**
  - 合法手生成では区別しない（両方とも対象）
  - DEFCONへの影響は実行時に判定

2. **自国が支配している国**
  - 相手に影響力があれば対象（支配状態は無関係）

3. **中立国**
  - どちらも支配していないが、相手影響力があれば対象

### 実装上の注意点
- 国の地域情報は`Country::getRegions()`で取得（複数地域可）
- DEFCON値は`board.getDefconTrack().getDefcon()`で取得
- 効率化のため、結果vectorの容量を事前予約

### 期待される出力例
例1：DEFCON 5（制限なし）
入力：

side: USSR
DEFCON: 5
手札: [カードA(3 Ops)]
盤面: USA影響力あり[日本:1, 西ドイツ:2, イラン:1, キューバ:1]

出力：4個のMove

カードA → 日本
カードA → 西ドイツ
カードA → イラン
カードA → キューバ

例2：DEFCON 3（欧州・アジア制限）
入力：

side: USSR
DEFCON: 3
手札: [カードA(3 Ops)]
盤面: 同上

出力：2個のMove

カードA → イラン（中東）
カードA → キューバ（中米）
（日本と西ドイツは除外）


### 地域分類の確認事項
- 東欧・西欧は両方とも「ヨーロッパ」として扱う
- 東南アジアは「アジア」に含まれる
- 中南米（Central/South America）はDEFCON制限の対象外
- アフリカもDEFCON制限の対象外

---

## actionSpaceRaceLegalMoves

### 概要
プレイヤーが宇宙開発競争アクションを実行する際の合法手を生成する。
宇宙開発は、カードを破棄してダイスロールを行い、成功すれば宇宙開発トラックを前進させるアクション。
相手のイベントを無効化できる防御的な使い方もある。

### 入力
- `board`: 現在のゲーム状態
- `side`: アクションを実行するプレイヤー側（USSR/USA）

### 出力
- `std::vector<std::shared_ptr<Move>>`: 宇宙開発に使用可能な各カードのSpaceRaceMove

### 基本ルール

#### 宇宙開発の実行条件
1. **試行回数制限**（`canSpaceChallenge`で判定）
  - 基本：1ターンに1回まで
  - 宇宙開発トラック進行により緩和される場合がある
  - 既に上限に達している場合は実行不可

2. **必要Ops値**（`canSpace`で判定）
  - 宇宙開発トラックの現在位置により異なる
  - 初期段階：2 Ops以上
  - 中期段階：3 Ops以上
  - 後期段階：3-4 Ops以上
  - カードのOps値が必要値未満の場合は使用不可

3. **位置による制限**
  - 特定の位置では「そもそも宇宙開発できない」場合がある
  - 最終位置（8）に到達済みの場合は実行不可

#### 使用可能なカード
- **使用可能**：
 - 自分側のイベントカード
 - 相手側のイベントカード（イベント発動を防げる）
 - 中立イベントカード
 - 中国カード

- **使用不可**：
 - スコアカード

### 処理仕様

#### 前提条件チェック
1. **手札が0枚の場合** → 空のリストを返す
2. **試行回数上限チェック** → `canSpaceChallenge(side)`がfalseなら空のリスト
3. **宇宙開発完了チェック** → 位置8到達済みなら空のリスト

#### カードの選別フロー
1. 手札の各カードについて：
  - スコアリングカード → スキップ
  - 中国カード → スキップ
  - その他のカード → Ops値をチェック
2. `canSpace(side, カードのOps値)`で使用可能か判定
3. 使用可能なカードのみでMoveを生成

### テストケースで確認すべきポイント

#### 基本的なケース
1. **標準的な宇宙開発**
  - 宇宙開発位置：1（初期段階）
  - 手札：[2 Ops, 3 Ops, 1 Ops]
  - 試行回数：未使用
  - 期待：2 Opsと3 OpsのカードのみでMove生成

2. **必要Ops値の変化**
  - 位置により必要Ops値が変わることを確認
  - 同じ手札でも位置によって選択肢が変わる

#### エッジケース
1. **手札なし** → 空のリスト
2. **試行回数制限到達** → 空のリスト（`canSpaceChallenge`がfalse）
3. **宇宙開発完了済み**（位置8） → 空のリスト
4. **全カードがOps不足**
  - 必要3 Opsで、手札が全て1-2 Ops
  - 期待：空のリスト

5. **特殊カードのみの手札**
  - スコアリングカードと中国カードのみ
  - 期待：空のリスト

#### 特殊なケース
1. **相手イベントカードの使用**
  - 相手側のイベントカードも選択可能
  - イベント無効化の戦略的選択

2. **試行回数緩和の確認**
  - 特定の宇宙開発位置で2回目の試行が可能
  - 1回目実行後も`canSpaceChallenge`がtrueなら再度選択可能

3. **複数の同Opsカード**
  - 3 Opsカードが3枚ある場合
  - 期待：3つの独立したMove

### 実装上の注意点
- カードの種別判定（スコアリング、中国カード）の実装が必要
- `SpaceTrack`の各メソッドを適切に使用
- 効率化のため、最初に`canSpaceChallenge`をチェック

### 期待される出力例
例1：初期段階（位置0-3、必要2 Ops）
入力：

side: USSR
宇宙開発位置: 1
試行済み: 0回
手札: [Duck and Cover(3 Ops), Defectors(2 Ops), UN Intervention(1 Ops), Europe Scoring]

出力：2個のMove

SpaceRaceMove(Duck and Cover)
SpaceRaceMove(Defectors)
（1 OpsとScoringは除外、中国カードは使用可能）

例2：中期段階（位置4-6、必要3 Ops）
入力：

side: USA
宇宙開発位置: 5
試行済み: 0回
手札: [Warsaw Pact Formed(3 Ops), Defectors(2 Ops), China Card(4 Ops)]

出力：1個のMove

SpaceRaceMove(Blockade)
（2 Opsは不足、China Cardは使用不可）

例3：試行回数制限
入力：

side: USSR
宇宙開発位置: 3
試行済み: 1回（上限到達）
手札: [任意のカード]

出力：空のvector

---

## actionEventLegalMoves

### 概要
プレイヤーがイベントアクションを実行する際の合法手を生成する。
カードに記載されたイベント効果を発動させるアクション。
スコアリングカードは必ずイベントとして実行する必要がある。

### 入力
- `board`: 現在のゲーム状態
- `side`: アクションを実行するプレイヤー側（USSR/USA）

### 出力
- `std::vector<std::shared_ptr<Move>>`: イベントとして実行可能な各カードのEventMove

### 基本ルール

#### イベント実行の可否
1. **実行可能なイベント**：
  - 自分側のイベントカード（選択的）
  - 相手側のイベントカード（宇宙以外矯正）
  - 中立イベントカード（選択的）
  - スコアリングカード（**必須**）

2. **実行不可なイベント**：
  - 中国カード（Opsアクションのみ可能）
  - イベントの発動条件を満たしていないカード(Cardsにそのようなメソッドを作成)

#### カードの分類
- **自分側**：カードのsideがプレイヤーのsideと一致
- **相手側**：カードのsideが相手のside
- **中立**：カードのsideがNEUTRAL
- **スコアリング**：地域スコアリングカード（特別扱い）

### 処理仕様

#### 前提条件チェック
1. **手札が0枚の場合** → 空のリストを返す

#### カードの選別フロー
1. 手札の各カードについて：
  - 中国カード → スキップ（イベント実行不可）
  - スコアリングカード → 必ず含める
  - その他のイベントカード → 含める
2. 各対象カードでActionEventMoveを生成

### テストケースで確認すべきポイント

#### 基本的なケース
1. **混在する手札**
  - 手札：[自分イベント, 相手イベント, 中立イベント]
  - 期待：3個のEventMove

2. **スコアリングカード必須**
  - 手札：[Europe Scoring, 他のカード]
  - 期待：Europe ScoringのEventMoveは必ず含まれる

3. **発動条件を満たさないカード**
  - 手札：[自分イベント, 中立イベント(発動条件を満たさない)]
  - 期待：自分イベントのみ

#### エッジケース
1. **手札なし** → 空のリスト
2. **中国カードのみ** → 空のリスト（イベント実行不可）
3. **全てスコアリングカード**
  - 手札：[Europe Scoring, Asia Scoring]
  - 期待：2個のEventMove

### 実装上の注意点
- カードの種別判定（スコアリング、中国カード）の実装が必要
- カードのside属性を正しく参照
- イベント効果の有無の判定方法

### 期待される出力例
例1：標準的な手札
入力：

side: USSR
手札: [
Duck&Cover(USA側イベント),
Decolonization(USSR側イベント),
UN Intervention(中立イベント),
China Card,
Europe Scoring
]

出力：4個のMove

ActionEventMove(Duck&Cover)
ActionEventMove(Decolonization)
ActionEventMove(UN Intervention)
ActionEventMove(Europe Scoring)
（China Cardは除外）

例2：スコアリング必須の確認
入力：

side: USA
手札: [Asia Scoring, Defectors(USSR側), China Card]

出力：2個のMove

ActionEventMove(Asia Scoring)
ActionEventMove(Defectors)

例3：イベントなしの手札
入力：

side: USSR
手札: [China Card]

出力：空のvector
